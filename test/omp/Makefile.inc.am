## -*- mode: makefile -*-

## 
## This file is part of the Score-P software (http://www.score-p.org)
##
## Copyright (c) 2009-2011, 
##    RWTH Aachen University, Germany
##    Gesellschaft fuer numerische Simulation mbH Braunschweig, Germany
##    Technische Universitaet Dresden, Germany
##    University of Oregon, Eugene, USA
##    Forschungszentrum Juelich GmbH, Germany
##    German Research School for Simulation Sciences GmbH, Juelich/Aachen, Germany
##    Technische Universitaet Muenchen, Germany
##
## See the COPYING file in the package base directory for details.
##

## file       Makefile.inc.am
## author     Christian Roessel <c.roessel@fz-juelich.de>
## maintainer Christian Roessel <c.roessel@fz-juelich.de>

if HAVE_OPENMP_SUPPORT

check_PROGRAMS += omp_test_unistrumented

omp_test_unistrumented_SOURCES  = $(SRC_ROOT)test/omp/omp_test.c
omp_test_unistrumented_CFLAGS   = $(AM_CFLAGS) $(OPENMP_CFLAGS)
#omp_test_unistrumented_CPPFLAGS = $(AM_CPPFLAGS) @COMPILER_INSTRUMENTATION_CPPFLAGS@
#omp_test_unistrumented_LDADD    = $(LIB_ROOT)libscorep_omp.la

#TESTS_OMP += omp_test_unistrumented


check_PROGRAMS += omp_test

# do not instrument the OPARI2 generated POMP code
noinst_LTLIBRARIES          += libomp_test_pomp.la
libomp_test_pomp_la_SOURCES  = $(SRC_ROOT)test/omp/pomp.c
libomp_test_pomp_la_CPPFLAGS = $(AM_CPPFLAGS)

omp_test_SOURCES  = $(SRC_ROOT)test/omp/omp_test.mod.c       \
                    $(SRC_ROOT)test/omp/omp_test.c.opari.inc
omp_test_CFLAGS   = $(AM_CFLAGS) $(OPENMP_CFLAGS)
omp_test_CPPFLAGS = $(AM_CPPFLAGS) @OPARI2_CPPFLAGS@ @COMPILER_INSTRUMENTATION_CPPFLAGS@
omp_test_LDADD    = $(LIB_ROOT)libscorep_omp.la $(LIB_ROOT)libomp_test_pomp.la

if HAVE_PAPI
omp_test_LDFLAGS  = @SCOREP_PAPI_LDFLAGS@
endif

TESTS_OMP += $(srcdir)/../test/omp/run_omp_test.sh
EXTRA_DIST       += $(SRC_ROOT)test/omp/run_omp_test.sh

TESTS_OMP += $(srcdir)/../test/omp/run_omp_test_profile.sh
EXTRA_DIST       += $(SRC_ROOT)test/omp/run_omp_test_profile.sh

check_PROGRAMS += internal_thread_handling

internal_thread_handling_SOURCES  = $(SRC_ROOT)test/omp/internal_thread_handling.c       \
                                    $(SRC_ROOT)test/omp/omp_test.c.opari.inc
internal_thread_handling_CFLAGS   = $(AM_CFLAGS) $(OPENMP_CFLAGS)
internal_thread_handling_CPPFLAGS = $(AM_CPPFLAGS) @OPARI2_CPPFLAGS@ @COMPILER_INSTRUMENTATION_CPPFLAGS@
internal_thread_handling_LDADD    = $(LIB_ROOT)libscorep_omp.la $(LIB_ROOT)libomp_test_pomp.la

if HAVE_PAPI
internal_thread_handling_LDFLAGS  = @SCOREP_PAPI_LDFLAGS@
endif

TESTS_OMP += $(srcdir)/../test/omp/run_internal_thread_handling.sh
EXTRA_DIST       += $(SRC_ROOT)test/omp/run_internal_thread_handling.sh

endif
