## -*- mode: makefile -*-

## 
## This file is part of the Score-P software (http://www.score-p.org)
##
## Copyright (c) 2009-2012, 
##    RWTH Aachen University, Germany
##    Gesellschaft fuer numerische Simulation mbH Braunschweig, Germany
##    Technische Universitaet Dresden, Germany
##    University of Oregon, Eugene, USA
##    Forschungszentrum Juelich GmbH, Germany
##    German Research School for Simulation Sciences GmbH, Juelich/Aachen, Germany
##    Technische Universitaet Muenchen, Germany
##
## See the COPYING file in the package base directory for details.
##

## file       Makefile.mpi.inc.am
## author     Yury Oleynik <oleynik@in.tum.de>
## maintainer Yury Oleynik <oleynik@in.tum.de>

if MPI_SUPPORTED


## MPI Fortran

##if HAVE_MPIFC

##if FORTRAN_SUPPORT_ALLOCATABLE

## Apart Test Suite to run with Online Access mode

if HAVE_ONLINE_ACCESS

check_PROGRAMS                  += mpi_patt_all_test_f90_with_oa
mpi_patt_all_test_f90_with_oa_SOURCES    = $(SRC_ROOT)test/apart_test_suite/fortran/calibrate.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/work.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/type_convert.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/distribution.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/mpi_util.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/mpi_pattern.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/mpi_patt_all_test.F90

mpi_patt_all_test_f90_with_oa_CPPFLAGS = \
    -I$(PUBLIC_INC_DIR)                     \
    -I$(INC_ROOT)src/adapters/include       \
    -I$(INC_DIR_UTIL)

if SCOREP_COMPILER_IBM
mpi_patt_all_test_f90_with_oa_CPPFLAGS += -WF,-DSCOREP_USER_ENABLE=1
else
mpi_patt_all_test_f90_with_oa_CPPFLAGS += -DSCOREP_USER_ENABLE=1
endif

mpi_patt_all_test_f90_with_oa_LDADD      = $(LIB_DIR_SCOREP)libscorep_mpi.la	

if HAVE_PAPI
mpi_patt_all_test_f90_with_oa_LDFLAGS    = $(SCOREP_PAPI_LDFLAGS) $(SCOREP_PAPI_LIBS) -Wl,-rpath,$(SCOREP_PAPI_LIBDIR)
endif

EXTRA_DIST += $(SRC_ROOT)test/apart_test_suite/run_apart_test_suite_with_oa_test.sh

CLEANFILES += work.mod calibrate.mod type_convert.mod mpi_util.mod mpi_pattern.mod

endif #if HAVE_ONLINE_ACCESS

## Apart Test Suite to run without Online Access mode

check_PROGRAMS                  += mpi_patt_all_test_f90
mpi_patt_all_test_f90_SOURCES    = $(SRC_ROOT)test/apart_test_suite/fortran/calibrate.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/work.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/type_convert.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/distribution.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/mpi_util.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/mpi_pattern.f90 \
                                   $(SRC_ROOT)test/apart_test_suite/fortran/mpi_patt_all_test.F90

mpi_patt_all_test_f90_CPPFLAGS = \
    -I$(PUBLIC_INC_DIR)                     \
    -I$(INC_ROOT)src/adapters/include       \
    -I$(INC_DIR_UTIL)

mpi_patt_all_test_f90_LDADD      = $(LIB_DIR_SCOREP)libscorep_mpi.la	

if HAVE_PAPI
mpi_patt_all_test_f90_LDFLAGS    = $(SCOREP_PAPI_LDFLAGS) $(SCOREP_PAPI_LIBS) -Wl,-rpath,$(SCOREP_PAPI_LIBDIR)
endif

TESTS_MPI += mpi_patt_all_test_f90

CLEANFILES += work.mod calibrate.mod type_convert.mod mpi_util.mod mpi_pattern.mod distribution.mod

##endif
# if FORTRAN_SUPPORT_ALLOCATABLE

##endif
# if HAVE_MPIFC

endif
# if MPI_SUPPOERTED
