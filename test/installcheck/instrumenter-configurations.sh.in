#!/bin/sh

## -*- mode: sh -*-

## @configure_input@

## 
## This file is part of the Score-P software (http://www.score-p.org)
##
## Copyright (c) 2009-2011, 
##    RWTH Aachen, Germany
##    Gesellschaft fuer numerische Simulation mbH Braunschweig, Germany
##    Technische Universitaet Dresden, Germany
##    University of Oregon, Eugene, USA
##    Forschungszentrum Juelich GmbH, Germany
##    German Research School for Simulation Sciences GmbH, Juelich/Aachen, Germany
##    Technische Universitaet Muenchen, Germany
##
## See the COPYING file in the package base directory for details.
##

## file       test/installcheck/instrumenter-configurations.sh.in
## maintainer Christian Roessel <c.roessel@fz-juelich.de>

comp_arg=""
pomp_user_arg=""
pdt_arg=""
cobi_arg=""
omp_arg=""
mpi_arg=""

file_prefix="../installcheck/configurations_"

# nompi: meaning unclear. we might implement is as "without mpi
# wrapping except for init/finalize". Still it makes no sense for
# non-mpi sources.

# noompenmp: if we model it like nompi, then we need to intercept just
# the fork/join/thread_begin/therad_end. Everything else gets ignored.

# pomp_user_arg: use HAVE_OPARI2_TRUE when it is implemented 


cd @abs_top_builddir@

# remove files from previous invocation
for paradigm in serial omp mpi mpi_omp; do
    rm -f ${file_prefix}${paradigm}
done

# create possible configurations, one file per paradigm
@SCOREP_COMPILER_SUN_FALSE@@HAVE_COMPILER_INSTRUMENTATION_TRUE@for comp_arg in compiler nocompiler; do
@SCOREP_COMPILER_SUN_TRUE@@HAVE_COMPILER_INSTRUMENTATION_TRUE@for comp_arg in nocompiler; do

    for pomp_user_arg in pomp nopomp; do
@HAVE_PDT_TRUE@        for pdt_arg in pdt nopdt; do
@HAVE_PDT_FALSE@        for user_arg in user nouser; do

@HAVE_COBI_TRUE@                for cobi_arg in cobi nocobi; do

                    # --- output per paradigm begins --- #

                    # serial ----------------------------#
                    echo "$user_arg $comp_arg $pomp_user_arg $pdt_arg $cobi_arg" >> ${file_prefix}serial

                    # omp -------------------------------#
@HAVE_OPENMP_SUPPORT_TRUE@                    for omp_args in openmp; do # add noopenmp when multilibs are ready, see above comment
@HAVE_OPENMP_SUPPORT_TRUE@                        echo "$user_arg $comp_arg $pomp_user_arg $pdt_arg $cobi_arg $omp_arg" >> ${file_prefix}omp
@HAVE_OPENMP_SUPPORT_TRUE@                    done

                    # mpi -------------------------------#
@HAVE_MPI_SUPPORT_TRUE@                    for mpi_args in mpi; do # add nompi when multilibs are ready, see above comment
@HAVE_MPI_SUPPORT_TRUE@                        echo "$user_arg $comp_arg $pomp_user_arg $pdt_arg $cobi_arg $mpi_arg" >> ${file_prefix}mpi
@HAVE_MPI_SUPPORT_TRUE@                    done

                    # mpi_omp ---------------------------#
@HAVE_MPI_SUPPORT_TRUE@@HAVE_OPENMP_SUPPORT_TRUE@                    for mpi_args in mpi; do # add nompi when multilibs are ready, see above comment
@HAVE_MPI_SUPPORT_TRUE@@HAVE_OPENMP_SUPPORT_TRUE@                        for omp_args in openmp; do # add noopenmp when multilibs are ready, see above comment
@HAVE_MPI_SUPPORT_TRUE@@HAVE_OPENMP_SUPPORT_TRUE@                            echo "$user_arg $comp_arg $pomp_user_arg $pdt_arg $cobi_arg $mpi_arg $omp_arg" >> ${file_prefix}mpi_omp
@HAVE_MPI_SUPPORT_TRUE@@HAVE_OPENMP_SUPPORT_TRUE@                        done
@HAVE_MPI_SUPPORT_TRUE@@HAVE_OPENMP_SUPPORT_TRUE@                    done

                    # cuda ------------------------------#

                    # cuda_mpi --------------------------#

                    # ...  ------------------------------#

                    # --- output per paradigm ends --- #

@HAVE_COBI_TRUE@                done
@HAVE_PDT_FALSE@        done
@HAVE_PDT_TRUE@        done
    done
@HAVE_COMPILER_INSTRUMENTATION_TRUE@done

# Notify about created files
echo "  GEN    ${file_prefix}serial"
@HAVE_OPENMP_SUPPORT_TRUE@echo "  GEN    ${file_prefix}omp"
@HAVE_MPI_SUPPORT_TRUE@echo "  GEN    ${file_prefix}mpi"
@HAVE_MPI_SUPPORT_TRUE@@HAVE_OPENMP_SUPPORT_TRUE@echo "  GEN    ${file_prefix}mpi_omp"
