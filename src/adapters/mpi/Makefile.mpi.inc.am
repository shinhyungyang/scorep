## -*- mode: makefile -*-

if HAVE_MPI_SUPPORT
noinst_LTLIBRARIES += libscorep_adapter_mpi_c_wrapper.la
libscorep_adapter_mpi_c_wrapper_la_SOURCES =                  \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Communicator.c     \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Request.c          \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Init.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Cg.c               \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Coll.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Env.c              \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Err.c              \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Ext.c              \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Io.c               \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Misc.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_P2p.c              \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Reg.c              \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Rma.c              \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Spawn.c            \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Topo.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Type.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Communicator.h     \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Request.h          \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi.h                  \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Mpi_Reg.h              \
    $(SRC_ROOT)src/adapters/include/SCOREP_Mpi_Init.h	      \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_MPIHooks.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_MPIHooks.h	      \
    $(SRC_ROOT)src/adapters/mpi/scorep_mpiprofile.c           \
    $(SRC_ROOT)src/adapters/mpi/scorep_mpiprofile.h	

libscorep_adapter_mpi_c_wrapper_la_CPPFLAGS = \
    $(AM_CPPFLAGS)                          \
    $(UTILS_CPPFLAGS)                       \
    -I$(INC_ROOT)src/adapters/mpi           \
    -I$(INC_ROOT)src/adapters/include       \
    -I$(INC_ROOT)src/measurement/include    \
    -I$(INC_ROOT)src/measurement/online_access         \
    -I$(PUBLIC_INC_DIR)

## Disable mpi profiling hooks
##libscorep_adapter_mpi_c_wrapper_la_CPPFLAGS += -DSCOREP_MPI_NO_HOOKS 


SCOREP_MPI_FORTRAN_SOURCES =                                 \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Cg.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Coll.c           \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Env.c            \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Err.c            \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Ext.c            \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Io.c             \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Misc.c           \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_P2p.c            \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Rma.c            \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Spawn.c          \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Topo.c           \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Type.c           \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi.h                \
    $(SRC_ROOT)src/adapters/include/SCOREP_Fortran_Wrapper.h

noinst_LTLIBRARIES += libscorep_adapter_mpi_fortran_wrapper_sub1.la
libscorep_adapter_mpi_fortran_wrapper_sub1_la_SOURCES =   \
    $(SCOREP_MPI_FORTRAN_SOURCES)
libscorep_adapter_mpi_fortran_wrapper_sub1_la_CPPFLAGS =  \
    $(AM_CPPFLAGS)                                      \
    -I$(INC_ROOT)src/adapters/include                   \
    -I$(INC_ROOT)src/measurement/online_access       				\
    -I$(PUBLIC_INC_DIR)                                 \
    $(UTILS_CPPFLAGS)                                   \
    -DFSUB=SCOREP_FORTRAN_SUB1

noinst_LTLIBRARIES += libscorep_adapter_mpi_fortran_wrapper_sub2.la
libscorep_adapter_mpi_fortran_wrapper_sub2_la_SOURCES =   \
    $(SCOREP_MPI_FORTRAN_SOURCES)
libscorep_adapter_mpi_fortran_wrapper_sub2_la_CPPFLAGS =  \
    $(AM_CPPFLAGS)                                      \
    -I$(INC_ROOT)src/adapters/include                   \
    -I$(INC_ROOT)src/measurement/online_access       				\
    -I$(PUBLIC_INC_DIR)                                 \
    $(UTILS_CPPFLAGS)                                   \
    -DFSUB=SCOREP_FORTRAN_SUB2


noinst_LTLIBRARIES += libscorep_adapter_mpi_fortran_wrapper_sub3.la
libscorep_adapter_mpi_fortran_wrapper_sub3_la_SOURCES =   \
    $(SCOREP_MPI_FORTRAN_SOURCES)
libscorep_adapter_mpi_fortran_wrapper_sub3_la_CPPFLAGS =  \
    $(AM_CPPFLAGS)                                      \
    -I$(INC_ROOT)src/adapters/include                   \
    -I$(INC_ROOT)src/measurement/online_access       				\
    -I$(PUBLIC_INC_DIR)                                 \
    $(UTILS_CPPFLAGS)                                   \
    -DFSUB=SCOREP_FORTRAN_SUB3


noinst_LTLIBRARIES += libscorep_adapter_mpi_fortran_wrapper_sub4.la
libscorep_adapter_mpi_fortran_wrapper_sub4_la_SOURCES =   \
    $(SCOREP_MPI_FORTRAN_SOURCES)
libscorep_adapter_mpi_fortran_wrapper_sub4_la_CPPFLAGS =  \
    $(AM_CPPFLAGS)                                      \
    -I$(INC_ROOT)src/adapters/include                   \
    -I$(INC_ROOT)src/measurement/online_access       				\
    -I$(PUBLIC_INC_DIR)                                 \
    $(UTILS_CPPFLAGS)                                   \
    -DFSUB=SCOREP_FORTRAN_SUB4

noinst_LTLIBRARIES += libscorep_adapter_mpi_fortran_conv.la
libscorep_adapter_mpi_fortran_conv_la_SOURCES =           \
    $(SRC_ROOT)src/adapters/mpi/SCOREP_Fmpi_Init.f
if SCOREP_COMPILER_PGI
# due to the external declaration of MPI_WTIME, MPI_WTICK , PMPI_WTICK, and
# PMPI_WTIME in openmpi's mpif.h we get four undeclared symbols when linking
# applications to pgi-build libscorep_mpi[_omp].so. The language option
# noref_externals prevents this.
libscorep_adapter_mpi_fortran_conv_la_FFLAGS = $(AM_FFLAGS) -Mnoref_externals
endif

noinst_LTLIBRARIES += libscorep_adapter_mpi.la
libscorep_adapter_mpi_la_SOURCES =
libscorep_adapter_mpi_la_LIBADD =                         \
    libscorep_adapter_mpi_c_wrapper.la                    \
    libscorep_adapter_mpi_fortran_wrapper_sub1.la         \
    libscorep_adapter_mpi_fortran_wrapper_sub2.la         \
    libscorep_adapter_mpi_fortran_wrapper_sub3.la         \
    libscorep_adapter_mpi_fortran_wrapper_sub4.la         \
    libscorep_adapter_mpi_fortran_conv.la
endif

